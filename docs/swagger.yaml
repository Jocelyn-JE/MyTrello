openapi: 3.1.0
info:
  title: MyTrello API
  version: 1.0.0
  description: API documentation for MyTrello project
tags:
  - name: documentation
    description: API documentation endpoints
  - name: users
    description: User authentication and management
  - name: boards
    description: Board management operations
servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /api-docs:
    get:
      tags:
        - documentation
      summary: Get this API documentation
      responses:
        "200":
          description: Successful response
  /api/register:
    post:
      tags:
        - users
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                username:
                  type: string
              required:
                - email
                - password
                - username
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error400"
        "409":
          $ref: "#/components/responses/Error409"
        "500":
          $ref: "#/components/responses/Error500"

  /api/login:
    post:
      tags:
        - users
      summary: Login as a user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
              required:
                - email
                - password
      responses:
        "200":
          description: User logged in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  user:
                    $ref: "#/components/schemas/User"
                  token:
                    type: string
        "400":
          $ref: "#/components/responses/Error400"
        "404":
          $ref: "#/components/responses/Error404"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users:
    get:
      tags:
        - users
      summary: Get all users
      description: Retrieve a list of all users (limited to 100, ordered by username)
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/search:
    get:
      tags:
        - users
      summary: Search users with filters
      description: Search for users by username or email with optional ordering and count limit. Can also filter by board membership and role.
      parameters:
        - name: username
          in: query
          description: Filter by username (starts with)
          schema:
            type: string
        - name: email
          in: query
          description: Filter by email (starts with)
          schema:
            type: string
        - name: order
          in: query
          description: Sort order for results
          schema:
            type: string
            enum: [asc, desc]
        - name: count
          in: query
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
        - name: boardId
          in: query
          description: Filter by board ID (returns members and/or viewers of this board)
          schema:
            type: string
            format: uuid
        - name: member
          in: query
          description: Filter for users who are members (of specified board if boardId provided, or any board)
          schema:
            type: boolean
        - name: viewer
          in: query
          description: Filter for users who are viewers (of specified board if boardId provided, or any board)
          schema:
            type: boolean
        - name: cardId
          in: query
          description: Filter by card ID (for checking card assignments)
          schema:
            type: string
            format: uuid
        - name: assigned
          in: query
          description: Filter for users assigned/not assigned to the card specified by cardId. If false, returns users NOT assigned to the card (useful for showing assignable users). If true or omitted with cardId, returns users assigned to the card.
          schema:
            type: boolean
      responses:
        "200":
          description: Users found successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error400"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/{boardId}/members:
    get:
      tags:
        - users
      summary: Get board members
      description: Retrieve all users who are members of a specific board
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board members retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/{boardId}/viewers:
    get:
      tags:
        - users
      summary: Get board viewers
      description: Retrieve all users who are viewers of a specific board
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board viewers retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "500":
          $ref: "#/components/responses/Error500"

  /api/boards:
    post:
      tags:
        - boards
      summary: Create a new board
      description: Create a new board with title and assigned users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: The board title
                users:
                  type: array
                  description: Array of users to assign to the board
                  items:
                    $ref: "#/components/schemas/BoardUserInput"
              required:
                - title
                - users
      responses:
        "201":
          description: Board created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board created successfully
                  board:
                    $ref: "#/components/schemas/BoardWithUsers"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

    get:
      tags:
        - boards
      summary: Get user's boards
      description: Retrieve all boards where the authenticated user is owner, member, or viewer
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Boards retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Boards retrieved successfully
                  boards:
                    type: array
                    items:
                      $ref: "#/components/schemas/BoardWithUsers"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  /api/boards/{boardId}:
    get:
      tags:
        - boards
      summary: Get a specific board
      description: Retrieve details of a specific board. User must be the owner, member, or viewer of the board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board to retrieve
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board retrieved successfully
                  board:
                    $ref: "#/components/schemas/BoardWithUsers"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          $ref: "#/components/responses/Error403"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

    put:
      tags:
        - boards
      summary: Update a board
      description: Update a board's title and users. Only the board owner can update the board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board to update
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: The board title
                users:
                  type: array
                  description: Array of users to assign to the board
                  items:
                    $ref: "#/components/schemas/BoardUserInput"
              required:
                - title
                - users
      responses:
        "200":
          description: Board updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board updated successfully
                  board:
                    $ref: "#/components/schemas/BoardWithUsers"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          $ref: "#/components/responses/Error403"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

    delete:
      tags:
        - boards
      summary: Delete a board
      description: Delete a board. Only the board owner can delete the board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board to delete
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board deleted successfully
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          $ref: "#/components/responses/Error403"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      description: Standard error payload
      required:
        - error
      properties:
        error:
          type: string
          description: Human readable error description
          example: Error XXX because of YYY
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        username:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Board:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        ownerId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    BoardUserInput:
      type: object
      description: User assignment for a board
      properties:
        id:
          type: string
          format: uuid
          description: User ID
        role:
          type: string
          enum: [member, viewer]
          description: User role on the board
      required:
        - id
        - role
    BoardWithUsers:
      allOf:
        - $ref: "#/components/schemas/Board"
        - type: object
          properties:
            owner:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                username:
                  type: string
            members:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  username:
                    type: string
                  email:
                    type: string
                    format: email
            viewers:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  username:
                    type: string
                  email:
                    type: string
                    format: email
  responses:
    Error400:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error401:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error403:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error404:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error409:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error500:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
