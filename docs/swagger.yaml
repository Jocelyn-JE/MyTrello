openapi: 3.1.0
info:
  title: MyTrello API
  version: 1.0.0
  description: API documentation for MyTrello project
tags:
  - name: documentation
    description: API documentation endpoints
  - name: users
    description: User authentication and management
  - name: boards
    description: Board management operations
  - name: cards
    description: Card management operations
servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /api-docs:
    get:
      tags:
        - documentation
      summary: Get this API documentation
      responses:
        "200":
          description: Successful response
  /api/register:
    post:
      tags:
        - users
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                username:
                  type: string
              required:
                - email
                - password
                - username
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error400"
        "409":
          $ref: "#/components/responses/Error409"
        "500":
          $ref: "#/components/responses/Error500"

  /api/login:
    post:
      tags:
        - users
      summary: Login as a user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
              required:
                - email
                - password
      responses:
        "200":
          description: User logged in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  user:
                    $ref: "#/components/schemas/User"
                  token:
                    type: string
        "400":
          $ref: "#/components/responses/Error400"
        "404":
          $ref: "#/components/responses/Error404"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  /api/preferences:
    get:
      tags:
        - users
      summary: Get user preferences
      description: Retrieve the preferences for the authenticated user.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Preferences retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreferences"
        "401":
          $ref: "#/components/responses/Error401"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"
    patch:
      tags:
        - users
      summary: Update user preferences
      description: Update one or more preferences for the authenticated user. Only provided fields will be updated.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                localization:
                  type: string
                  description: Localization setting (e.g., "en/US", "fr/FR")
                  example: "en/US"
                theme:
                  type: string
                  enum: [dark, light, system]
                  description: UI theme preference
                  example: "system"
                showAssignedCardsInHomepage:
                  type: boolean
                  description: Whether to show assigned cards on the homepage
                  example: true
      responses:
        "200":
          description: Preferences updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreferences"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users:
    get:
      tags:
        - users
      summary: Get all users
      description: Retrieve a list of all users (limited to 100, ordered by username). Requires authentication.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"
    delete:
      tags:
        - users
      summary: Delete own account
      description: Delete the authenticated user's account. Requires current password for verification. This action is irreversible and will delete all user data.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                currentPassword:
                  type: string
                  description: Current password for verification
              required:
                - currentPassword
      responses:
        "200":
          description: Account deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Account deleted successfully
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          description: Unauthorized - Invalid password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/search:
    get:
      tags:
        - users
      summary: Search users with filters
      description: |
        Search for users by username or email with optional ordering and count limit. Can also filter by board membership and role.

        **Authorization**: When searching by `boardId`, the authenticated user must be the owner, member, or viewer of that board.
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: query
          description: Filter by username (starts with)
          schema:
            type: string
        - name: email
          in: query
          description: Filter by email (starts with)
          schema:
            type: string
        - name: order
          in: query
          description: Sort order for results
          schema:
            type: string
            enum: [asc, desc]
        - name: count
          in: query
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
        - name: boardId
          in: query
          description: Filter by board ID (returns members and/or viewers of this board)
          schema:
            type: string
            format: uuid
        - name: member
          in: query
          description: Filter for users who are members or owners (of specified board if boardId provided, or any board). Board owners are always included when filtering for members.
          schema:
            type: boolean
        - name: viewer
          in: query
          description: Filter for users who are viewers (of specified board if boardId provided, or any board)
          schema:
            type: boolean
        - name: cardId
          in: query
          description: Filter by card ID (for checking card assignments)
          schema:
            type: string
            format: uuid
        - name: assigned
          in: query
          description: Filter for users assigned/not assigned to the card specified by cardId. If false, returns users NOT assigned to the card (useful for showing assignable users). If true or omitted with cardId, returns users assigned to the card.
          schema:
            type: boolean
      responses:
        "200":
          description: Users found successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          description: Forbidden - User does not have access to the specified board
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/{boardId}/members:
    get:
      tags:
        - users
      summary: Get board members
      description: |
        Retrieve all users who are members of a specific board.

        **Authorization**: The authenticated user must be the owner, member, or viewer of the specified board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board members retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          description: Forbidden - User does not have access to this board
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/{boardId}/viewers:
    get:
      tags:
        - users
      summary: Get board viewers
      description: |
        Retrieve all users who are viewers of a specific board.

        **Authorization**: The authenticated user must be the owner, member, or viewer of the specified board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board viewers retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          description: Forbidden - User does not have access to this board
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/username:
    patch:
      tags:
        - users
      summary: Update username
      description: Update the authenticated user's username
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  description: The new username
              required:
                - username
      responses:
        "200":
          description: Username updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Username updated successfully
                  user:
                    $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/email:
    patch:
      tags:
        - users
      summary: Update email
      description: Update the authenticated user's email. Requires current password for verification.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  description: The new email address
                currentPassword:
                  type: string
                  description: Current password for verification
              required:
                - email
                - currentPassword
      responses:
        "200":
          description: Email updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Email updated successfully
                  user:
                    $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          description: Unauthorized - Invalid password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          $ref: "#/components/responses/Error404"
        "409":
          description: Conflict - Email already in use
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          $ref: "#/components/responses/Error500"

  /api/users/password:
    patch:
      tags:
        - users
      summary: Update password
      description: Update the authenticated user's password. Requires current password for verification.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                currentPassword:
                  type: string
                  description: Current password for verification
                newPassword:
                  type: string
                  description: New password
              required:
                - currentPassword
                - newPassword
      responses:
        "200":
          description: Password updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password updated successfully
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          description: Unauthorized - Invalid password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

  /api/boards:
    post:
      tags:
        - boards
      summary: Create a new board
      description: Create a new board with title and assigned users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: The board title
                users:
                  type: array
                  description: Array of users to assign to the board
                  items:
                    $ref: "#/components/schemas/BoardUserInput"
              required:
                - title
                - users
      responses:
        "201":
          description: Board created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board created successfully
                  board:
                    $ref: "#/components/schemas/BoardWithUsers"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

    get:
      tags:
        - boards
      summary: Get user's boards
      description: Retrieve all boards where the authenticated user is owner, member, or viewer
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Boards retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Boards retrieved successfully
                  boards:
                    type: array
                    items:
                      $ref: "#/components/schemas/BoardWithUsers"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  /api/boards/{boardId}:
    get:
      tags:
        - boards
      summary: Get a specific board
      description: Retrieve details of a specific board. User must be the owner, member, or viewer of the board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board to retrieve
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board retrieved successfully
                  board:
                    $ref: "#/components/schemas/BoardWithUsers"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          $ref: "#/components/responses/Error403"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

    put:
      tags:
        - boards
      summary: Update a board
      description: Update a board's title and users. Only the board owner can update the board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board to update
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: The board title
                users:
                  type: array
                  description: Array of users to assign to the board
                  items:
                    $ref: "#/components/schemas/BoardUserInput"
              required:
                - title
                - users
      responses:
        "200":
          description: Board updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board updated successfully
                  board:
                    $ref: "#/components/schemas/BoardWithUsers"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          $ref: "#/components/responses/Error403"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

    delete:
      tags:
        - boards
      summary: Delete a board
      description: Delete a board. Only the board owner can delete the board.
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          description: The ID of the board to delete
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Board deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Board deleted successfully
        "401":
          $ref: "#/components/responses/Error401"
        "403":
          $ref: "#/components/responses/Error403"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

  /api/cards/assigned:
    get:
      tags:
        - cards
      summary: Get cards assigned to the authenticated user
      description: Retrieve all cards that are assigned to the currently authenticated user, including board and column information for navigation
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Assigned cards retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Assigned cards retrieved successfully
                  cards:
                    type: array
                    items:
                      $ref: "#/components/schemas/AssignedCard"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      description: Standard error payload
      required:
        - error
      properties:
        error:
          type: string
          description: Human readable error description
          example: Error XXX because of YYY
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        username:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    UserPreferences:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        localization:
          type: string
          description: Localization setting
          example: "en/US"
        theme:
          type: string
          enum: [dark, light, system]
          description: UI theme preference
          example: "system"
        showAssignedCardsInHomepage:
          type: boolean
          description: Whether to show assigned cards on the homepage
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Board:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        ownerId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    BoardUserInput:
      type: object
      description: User assignment for a board
      properties:
        id:
          type: string
          format: uuid
          description: User ID
        role:
          type: string
          enum: [member, viewer]
          description: User role on the board
      required:
        - id
        - role
    BoardWithUsers:
      allOf:
        - $ref: "#/components/schemas/Board"
        - type: object
          properties:
            owner:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                username:
                  type: string
            members:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  username:
                    type: string
                  email:
                    type: string
                    format: email
            viewers:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  username:
                    type: string
                  email:
                    type: string
                    format: email
    AssignedCard:
      type: object
      description: Card with board and column information for navigation
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        content:
          type: string
        startDate:
          type: string
          format: date-time
          nullable: true
        dueDate:
          type: string
          format: date-time
          nullable: true
        columnId:
          type: string
          format: uuid
        columnTitle:
          type: string
          description: Title of the column containing this card
        boardId:
          type: string
          format: uuid
        boardTitle:
          type: string
          description: Title of the board containing this card
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
  responses:
    Error400:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error401:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error403:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error404:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error409:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Error500:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
